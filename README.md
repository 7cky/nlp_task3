# Nlp_ 任务三：基于注意力机制的文本匹配实验报告


## 一、实验目的
实现基于双向注意力机制的文本匹配模型，用于判断两个句子（前提句与假设句）之间的语义关系，完成自然语言推理（Natural Language Inference, NLI）任务。


## 二、实验过程

### 1. 数据集选择
本实验采用斯坦福自然语言推理数据集https://nlp.stanford.edu/projects/snli/。该数据集包含约57万对句子（前提句+假设句），每对句子被标注为三种语义关系之一：
- 蕴含（Entailment）：假设句的语义可由前提句推出；
- 矛盾（Contradiction）：假设句的语义与前提句冲突；
- 中性（Neutral）：假设句的语义与前提句既不蕴含也不矛盾。

### 2. 特征提取
分别采用随机词嵌入和预训练词嵌入（GloVe）作为文本的初始特征表示，具体配置和任务二一致

### 3. 神经网络模型
模型整体结构遵循ESIM框架，主要包含输入编码、局部推理建模、推理合成和输出四个模块，具体如下：

#### 3.1 Input Encoding（输入编码）
- **功能**：将词ID序列转换为上下文敏感的词向量。
- **实现**：
  - 词嵌入层：支持随机初始化或GloVe预训练向量；
  - 双向LSTM：捕捉每个词的上下文信息，输出编码序列`a_bar`（前提句）和`b_bar`（假设句）。

#### 3.2 Local Inference Modeling（局部推理建模）
- **功能**：计算句子对之间的局部匹配关系（词级注意力）。
- **实现**：
  - 计算注意力权重矩阵`e`（`e[i][j]`表示前提句第`i`个词与假设句第`j`个词的相似度）；
  - 生成对齐向量`a_tilde`（前提句对齐到假设句）和`b_tilde`（假设句对齐到前提句）；
  - 拼接原始编码与对齐向量的差异和乘积，增强特征表达。

#### 3.3 Inference Composition（推理合成）
- **功能**：对局部推理特征进行全局编码，捕捉高阶推理信息。
- **实现**：
  - 线性层调整特征维度；
  - 双向LSTM进一步编码特征，输出`v_a`（前提句全局特征）和`v_b`（假设句全局特征）。

#### 3.4 Output（输出层）
- **功能**：将全局特征映射到逻辑关系类别。
- **实现**：
  - 对`v_a`和`v_b`进行平均池化和最大池化；
  - 拼接池化结果，通过MLP输出分类概率。



### 4. 注意力机制与token2token attention
- **注意力机制**：核心思想是通过计算“关注度”为不同token分配不同权重，使模型聚焦于与当前任务相关的信息。在文本匹配中，注意力机制用于捕捉两个句子中语义相关的token对。注意力机制在 ESIM 的局部推理建模（Local Inference Modeling） 模块中实现，核心是通过计算两个句子中词与词（token-to-token）的相似度，生成注意力权重矩阵，进而捕捉句子对之间的局部匹配关系。
- **token2token attention**：属于细粒度双向注意力，实现了两个句子中每个token与对方所有token的交互。通过相似度矩阵和加权求和，每个token都能“看到”对方句子中最相关的部分。



## 三、实验环境

### 1. 实验配置
- **编程语言**：Python 3.10.18
- **深度学习框架**：PyTorch 2.7.1+cu118
- **环境**：镜像 Miniconda  conda3  Python  3.10(ubuntu22.04) CUDA  11.8
- **GPU**：vGPU-32GB(32GB) * 1
- **CPU**：12 vCPU Intel(R) Xeon(R) Platinum 8352V CPU @ 2.10GHzCPU（Intel i7）/ GPU（NVIDIA RTX 3090，12GB显存）
- **预训练词向量**：wiki_giga_2024_50_MFT20_vectors_seed_123_alpha_0.75_eta_0.075_combined

### 2. 参数设置
- 词向量维度：50
- LSTM隐藏层维度：50
- 批次大小（batch_size）：1000
- 学习率：0.001
- 迭代次数（epochs）：50
- 优化器：Adam
- 损失函数：交叉熵损失



## 四、实验结果
![main_plot](https://github.com/user-attachments/assets/06d3be98-df71-405f-be62-8cfe7abce638)

Glove词嵌入ESIM测试准确率达到0.88，超过随机词嵌入的0.82，Glove的测试损失为0.47，低于随机词嵌入的0.58。
